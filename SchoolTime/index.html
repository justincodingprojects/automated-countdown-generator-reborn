<!DOCTYPE html>
<html>
<head>
<title>School Time</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
<link rel="shortcut icon" type="image/png" href="icon.png">
<style>
body, select, button {
  font-family: 'Montserrat', sans-serif;
  text-align: center;
  font-size: 24px;
}
body {
  height: 100vh;
  overflow: hidden;
}
h1, #br {font-size:128px;}
h2 {font-size: 32px;}
#bottomBar {
  background-color: black;
  color: white;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100vw;
  text-align: left;
  padding: 8px;
}
#sideBar {
  background-color: rgba(50, 50, 50, 0.5);
  color: white;
  font-size: 32px;
  position: absolute;
  top: 0;
  right: 0;
  width: 460px;
  text-align: left;
  padding: 16px;
  display: none;
}
#settingsBar {
  background-color: rgba(50, 50, 50, 0.5);
  color: white;
  font-size: 32px;
  position: absolute;
  top: 0;
  left: 0;
  width: 460px;
  text-align: left;
  padding: 16px;
  display: none;
}
input {height: 24px;}
#mono {width: 24px;}
#bottomButton {
  float: right;
  margin-right: 16px;
}
#alert {
  position: absolute;
  margin: auto;
  padding: 16px;
  left: 0;
  right: 0;
  font-size: 32px;
  border-style: solid;
  visibility: hidden;
  background-color: white;
}
#alertHeader {
  font-weight: bold;
  font-size: 48px;
}
#okButton {
  right: 50%;
}
</style>
</head>
<body onload="load()">
<div id="alert">
<span id="alertHeader">Info</span><br>
<span id="alertContent"></span><br>
<button type="button" id="okButton" onclick="inforead()">Ok</button>
</div>
<br id="br">
<h1 id="time">Loading...</h1>
<h2 id="date">Loading...</h2>
<h2 id="period">Loading...</h2>
<h2 id="countdown">Loading...</h2>
<div id="settingsBar">
  <label for="mono">Use Monospace Font?</label>
  <input type="checkbox" id="mono" name="mono">
  <label for="timeDelay">Delay between updates (in ms):</label>
  <input type="number" id="timeDelay" name="timeDelay" value="250"><br>
  <button type="button" onclick="editor()">Editor Mode</button>
</div>
<div id="sideBar"></div>
<div id="bottomBar">
<label for="school">School:</label>
<select name="school" id="school">
  <option value="lehigh">Lehigh Senior High</option>
</select>
<label for="eventType">Schedule:</label>
<select name="eventType" id="eventType">
  <option value="midtermday2">Midterm Day #2 (12/19)</option>
</select>
<button type="button" id="bottomButton" onclick="applyButton()">Apply</button>
<button type="button" id="bottomButton" onclick="getSchedule()">Schedule</button>
<button type="button" id="bottomButton" onclick="displayMode()">Display Mode</button>
<button type="button" id="bottomButton" onclick="settingsMenu()">More Settings</button>
</div>
<script>
var selectedEvents, wakeLock, timeDelay;

const unavailableEvents = [
{name: "These events haven't been added yet.", time: new Date(2000, 1, 1, 0, 0, 0, 0)},
{name: "New Day", time: new Date(2000, 1, 1, 24, 0, 0, 0)}
];
const lehighSeniorMidtermDay2 = [
{name: "School hasn't started yet.", time: new Date(2000, 1, 1, 0, 0, 0, 0)},
{name: "Start of Day", time: new Date(2000, 1, 1, 6, 30, 0, 0)},
{name: "Passing Time", time: new Date(2000, 1, 1, 6, 50, 0, 0)},
{name: "1st Period", time: new Date(2000, 1, 1, 7, 5, 0, 0)},
{name: "Passing Time", time: new Date(2000, 1, 1, 8, 42, 0, 0)},
{name: "3rd Period", time: new Date(2000, 1, 1, 8, 47, 0, 0)},
{name: "Passing Time", time: new Date(2000, 1, 1, 9, 33, 0, 0)},
{name: "4th Period", time: new Date(2000, 1, 1, 9, 38, 0, 0)},
{name: "Passing Time", time: new Date(2000, 1, 1, 10, 24, 0, 0)},
{name: "5th Period", time: new Date(2000, 1, 1, 10, 29, 0, 0)},
{name: "Passing Time", time: new Date(2000, 1, 1, 12, 44, 0, 0)},
{name: "7th Period", time: new Date(2000, 1, 1, 12, 49, 0, 0)},
{name: "School has ended.", time: new Date(2000, 1, 1, 13, 35, 0, 0)},
{name: "New Day", time: new Date(2000, 1, 1, 24, 0, 0, 0)}
];
function load() {
  applySettings("lehigh", false, "normal", 250);
  setTime();
  wakeLock();
  // alertBox("");
}
function getCurrentEvent(events, time) {
  var found = false;
  for (var i = 0; i < events.length && !(found); i++) {
    if (events[i].time.getTime() > time.getTime()) {found = true;}
  }
  return (i - 2);
}
function setTime() {
  var date = new Date();var timeNoDate = new Date();
  timeNoDate.setFullYear(2000);
  timeNoDate.setMonth(1, 1);
  const timeDifference = new Date(selectedEvents[getCurrentEvent(selectedEvents, timeNoDate) + 1].time - timeNoDate);
  var hour = date.getHours();
  var min = date.getMinutes();
  var sec = date.getSeconds();
  var year = date.getFullYear();
  var month = date.getMonth();
  var day = date.getDate();
  month = monthName(month);
  document.getElementById('period').innerHTML = selectedEvents[getCurrentEvent(selectedEvents, timeNoDate)].name;
  if (timeDifference.getDate() < 31) {
  document.getElementById('countdown').innerHTML = "Time until " + selectedEvents[getCurrentEvent(selectedEvents, timeNoDate) + 1].name.replace("School has ended.", "School Ends") + " - " + (timeDifference.getHours() - 18 + (timeDifference.getDate() * 24)) + ":" + fixTime(timeDifference.getMinutes()) + ":" + fixTime(timeDifference.getSeconds());
  }
  else if (timeDifference.getHours() > 18) {
  document.getElementById('countdown').innerHTML = "Time until " + selectedEvents[getCurrentEvent(selectedEvents, timeNoDate) + 1].name.replace("School has ended.", "School Ends") + " - " + (timeDifference.getHours() - 18) + ":" + fixTime(timeDifference.getMinutes()) + ":" + fixTime(timeDifference.getSeconds());
  }
  else {
  document.getElementById('countdown').innerHTML = "Time until " + selectedEvents[getCurrentEvent(selectedEvents, timeNoDate) + 1].name.replace("School has ended.", "School Ends") + " - " + timeDifference.getMinutes() + ":" + fixTime(timeDifference.getSeconds());
  }
  sec++;
  if (sec == 60) {sec = 0; min++;}
  if (min == 60) {min = 0; hour++;}
  var ampm;
  if (hour >= 12) {ampm = "PM";} else {ampm = "AM";}
  hour = fixHour(hour);
  min = fixTime(min);
  sec = fixTime(sec);
  document.getElementById('time').innerHTML = hour + ":" + min + ":" + sec + " " + ampm;
  document.getElementById('date').innerHTML = month + " " + day + ", " + year;
  setTimeout(setTime, timeDelay);
}
function fixTime(i) {
  if (i < 10) {i = "0" + i;}
  return i;
}
function fixHour(i) {
  if (i >= 13) {i = i - 12;}
  else if (i == 0) {i = 12;}
  return i;
}
function monthName(i) {
  if (i == 0) {i = "January";}
  if (i == 1) {i = "February";}
  if (i == 2) {i = "March";}
  if (i == 3) {i = "April";}
  if (i == 4) {i = "May";}
  if (i == 5) {i = "June";}
  if (i == 6) {i = "July";}
  if (i == 7) {i = "August";}
  if (i == 8) {i = "September";}
  if (i == 9) {i = "October";}
  if (i == 10) {i = "November";}
  if (i == 11) {i = "December";}
  return i;
}
function applySettings(school, mono, eventType, delay) {
  timeDelay = delay;
  var date = new Date();
  if (mono) {
    document.getElementById("time").style.fontFamily = "Roboto Mono, monospace";
    document.getElementById("date").style.fontFamily = "Roboto Mono, monospace";
    document.getElementById("period").style.fontFamily = "Roboto Mono, monospace";
    document.getElementById("countdown").style.fontFamily = "Roboto Mono, monospace";
  }
  else {
     document.getElementById("time").style.fontFamily = "Montserrat, sans-serif";
    document.getElementById("date").style.fontFamily = "Montserrat, sans-serif";
    document.getElementById("period").style.fontFamily = "Montserrat, sans-serif";
    document.getElementById("countdown").style.fontFamily = "Montserrat, sans-serif";
  }
  var e = document.getElementById("sideBar");
  e.textContent = '';
  if (selectedEvents.length % 2 == 1) {
    for (var i = 0; i < selectedEvents.length - 4; i = i + 2) {
      var t = document.createTextNode(selectedEvents[i + 2].name + ": " + fixHour(selectedEvents[i + 2].time.getHours()) + ":" + fixTime(selectedEvents[i + 2].time.getMinutes()) + "-" + fixHour(selectedEvents[i + 3].time.getHours()) + ":" + fixTime(selectedEvents[i + 3].time.getMinutes()));
      var br = document.createElement("br");
      e.appendChild(t);
      e.appendChild(br);
    }
  }
  else {
    for (var i = 0; i < selectedEvents.length - 2; i = i + 2) {
      var t = document.createTextNode(selectedEvents[i + 1].name + ": " + fixHour(selectedEvents[i + 1].time.getHours()) + ":" + fixTime(selectedEvents[i + 1].time.getMinutes()) + "-" + fixHour(selectedEvents[i + 2].time.getHours()) + ":" + fixTime(selectedEvents[i + 2].time.getMinutes()));
      var br = document.createElement("br");
      e.appendChild(t);
      e.appendChild(br);
    }
  }
}
function applyButton() {applySettings(document.getElementById("school").value, document.getElementById("mono").checked, document.getElementById("eventType").value, document.getElementById("timeDelay").value);}
function displayMode() {
  document.getElementById("bottomBar").style.display = 'none';
  document.body.style.cursor = 'none';
  document.documentElement.requestFullscreen();
}
function getSchedule() {
  var e = document.getElementById("sideBar");
  if (window.getComputedStyle(e).getPropertyValue('display') == 'none') {
    e.style.display = 'inline';
  }
  else {
    e.style.display = 'none';
  }
}
function settingsMenu() {
  var e = document.getElementById("settingsBar");
  if (window.getComputedStyle(e).getPropertyValue('display') == 'none') {
    e.style.display = 'inline';
  }
  else {
    e.style.display = 'none';
  }
}
function editor() {
  settingsMenu();
  document.body.style.overflow = 'visible';
  document.getElementById("bottomBar").id = "";
}
function alertBox(text) {
  document.getElementById("alert").style.visibility = 'visible';
  document.getElementById("alertContent").innerHTML = text;
}
function inforead() {document.getElementById("alert").style.visibility = 'hidden'}
document.addEventListener("keypress", function(e) {
  document.getElementById("bottomBar").style.display = 'inline';
  document.body.style.cursor = 'auto';
  document.exitFullscreen();
}, false);
async function wakeLock() {
  try {
    wakeLock = await navigator.wakeLock.request('screen');
  } catch (err) {
    console.log(`${err.name}, ${err.message}`);
  }
}
document.addEventListener('visibilitychange', async () => {
  if (wakeLock !== null && document.visibilityState === 'visible') {
    try {
      wakeLock = await navigator.wakeLock.request('screen');
    } catch (err) {
      console.log(`${err.name}, ${err.message}`);
    }
  }
});
</script>
</body>
</html>
